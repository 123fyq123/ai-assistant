(self.webpackChunk=self.webpackChunk||[]).push([[332],{1980:function(Ge,ee,d){"use strict";d.r(ee),d.d(ee,{ChatContext:function(){return W},default:function(){return Me}});var le=d(57213),T=d.n(le),de=d(93525),E=d.n(de),ce=d(54306),Q=d.n(ce),p=d(93236),ve=d(52510),fe=d.n(ve),te=d(45924),L={"layout-ai-slider":"layout-ai-slider___B4QiI",layoutAiSlider:"layout-ai-slider___B4QiI",topDiv:"topDiv___yf52R","menus-ul":"menus-ul___X0HBg",menusUl:"menus-ul___X0HBg","menus-li":"menus-li___JqtHJ",menusLi:"menus-li___JqtHJ",active:"active___i5rvn","li-title":"li-title___ossXQ",liTitle:"li-title___ossXQ","li-btns":"li-btns___LxGsy",liBtns:"li-btns___LxGsy"},ge=d(89260),a=d(62086);function pe(){var t=(0,p.useContext)(W),e=t.result,r=t.addResult,u=t.deleteResult,y=t.toggleActive;function n(l){return function(I){I.stopPropagation(),u(l.sessionId)}}function s(l){return function(I){I.stopPropagation();var h=e.find(function(J){return J.sessionId===l});h!=null&&h.active||y(l)}}function m(l){if(l.isLoading)return"\u67E5\u8BE2\u4E2D...";if(l.isInput)return"\u8F93\u5165\u4E2D...";var I;return((I=(0,ge.Z)(l.data,function(h){return h.type==="question"}))===null||I===void 0?void 0:I.content)||l.title}return(0,a.jsxs)("div",{className:L.layoutAiSlider,children:[(0,a.jsx)("div",{className:L.topDiv,children:(0,a.jsx)("button",{type:"button",onClick:r,children:"+ \u6DFB\u52A0\u65B0\u4F1A\u8BDD"})}),(0,a.jsx)("ul",{className:L.menusUl,children:e.map(function(l){return(0,a.jsxs)("li",{className:(0,te.Z)(L.menusLi,fe()({},L.active,l.active)),onClick:s(l.sessionId),children:[(0,a.jsx)("div",{className:L.liTitle,children:m(l)}),(0,a.jsx)("div",{className:L.liBtns,children:(0,a.jsx)("button",{type:"button",onClick:n(l),children:"\u5220\u9664"})})]},l.sessionId)})})]})}var ye=d(25359),j=d.n(ye),Ie=d(49811),Z=d.n(Ie),he={loading:"loading___MehV4"};function me(t){var e,r=Object.assign({},(e=t.style)!==null&&e!==void 0?e:{});return(0,a.jsxs)("div",{className:he.loading,style:r,children:[(0,a.jsx)("div",{}),(0,a.jsx)("div",{}),(0,a.jsx)("div",{})]})}var w={modifyBrowserScrollStyle:"modifyBrowserScrollStyle___W_Bf4",container:"container___kbjvA",ul:"ul___FpLJs",answerItem:"answerItem___vywcc",answerItemContent:"answerItemContent___jrp1w",logo:"logo___ESpoO",content:"content___vhxQQ",questionType:"questionType___Aagvk",triangle:"triangle___zwFRY",answerType:"answerType___A33LI",loadingType:"loadingType___C3NpY"};function Se(t){var e=(0,p.useRef)(null),r={question:w.questionType,answer:w.answerType,loading:w.loadingType};(0,p.useEffect)(function(){e.current&&(e.current.scrollTop=e.current.scrollHeight)});function u(n,s){if(n.type==="answer"){var m=n.content.split(/(\n|\r|\r\n)/);return m.map(function(l,I){return(0,a.jsx)("p",{className:t.inputing&&I===m.length-1&&s===t.data.length-1?"cursor-blingking":"",children:/^\s$/.test(l)?"":l.replace(/\s/g," ")},I)})}else{if(n.type==="question")return n.content;if(n.type==="loading")return(0,a.jsx)(me,{style:{top:"6px"}})}}function y(n,s){if(n.type==="answer"||n.type==="question")return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:w.triangle}),u(n,s)]});if(n.type==="loading")return u(n,s)}return(0,a.jsx)("div",{className:w.container,ref:e,children:(0,a.jsx)("ul",{className:w.ul,children:t.data.map(function(n,s){return(0,a.jsx)("li",{className:w.answerItem,children:(0,a.jsxs)("div",{className:(0,te.Z)(w.answerItemContent,r[n.type]),children:[(0,a.jsx)("span",{className:w.logo,children:n.type==="question"&&(0,a.jsx)("span",{children:"\u6211"})}),(0,a.jsx)("div",{className:w.content,children:y(n,s)})]})},n.id)})})})}var xe=!0,Re=d(74793),we=d(99168);function ne(t,e,r,u){return U.apply(this,arguments)}function U(){return U=Z()(j()().mark(function t(e,r,u,y){var n,s;return j()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,(0,Re.request)(e,Object.assign({method:r,getResponse:!0,headers:{"X-Trace-Id":(0,we.Z)()}},r==="GET"?{params:u}:{data:u},y));case 2:return s=l.sent,l.abrupt("return",(n=s==null?void 0:s.data)!==null&&n!==void 0?n:{});case 4:case"end":return l.stop()}},t)})),U.apply(this,arguments)}function Pe(t,e,r){return ne(t,"GET",e,r)}function Ne(t,e,r){return ne(t,"POST",e,r)}var Be={sendMsg:function(){var t=Z()(j()().mark(function r(u){var y;return j()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,Ne("/q/sendMsg",u,{responseType:xe?"stream":"json",getResponse:!0});case 2:return y=s.sent,console.log("chatgpt - /q/sendMsg:",y),s.abrupt("return",y);case 5:case"end":return s.stop()}},r)}));function e(r){return t.apply(this,arguments)}return e}()},P={container:"container___mJT0f",card:"card___ia0yb",questionWrapper:"questionWrapper___fmJv4",labelForInput:"labelForInput___qfwPY",input:"input___wbEmZ",sendBtn:"sendBtn___HlPFa"},se=d(17941),Ce=d(38625),Te=d.n(Ce),A="chenwy",F="xiaochen";function je(){var t=(0,p.useContext)(W),e=t.active,r=t.setResultDataBySessionId,u=t.setResultBySessionId,y=t.storageData,n=t.getConvasitionBySessionId,s=(e==null?void 0:e.data)||[],m=(e==null?void 0:e.isInput)||!1,l=(0,p.useState)(""),I=Q()(l,2),h=I[0],J=I[1],Y=(0,p.useState)(!1),b=Q()(Y,2),o=b[0],i=b[1],v=(0,p.useRef)(null),g=(0,se.Z)(s);function H(c,S){return M.apply(this,arguments)}function M(){return M=Z()(j()().mark(function c(S,x){var D,N,z,_,O,R,f,B,G,$;return j()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return i(!0),C.next=3,Be.sendMsg(T()({ownerId:A,parentMessageId:((D=n(x))===null||D===void 0?void 0:D.parentMessageId)||""},S));case 3:N=C.sent,z=N.code,_=N.data,O=N.msg,z===200?(B=n(x),console.log("convasition.data",(R=B==null?void 0:B.data)!==null&&R!==void 0?R:[]),G=(f=B==null?void 0:B.data.filter(function(q){return q.type!=="loading"}))!==null&&f!==void 0?f:[],$={type:"answer",ownerId:A,ownerName:F,content:_.text,id:_.id},console.log("getMsg..."),G.push($),u({data:G,parentMessageId:_.id,isLoading:!1},x)):alert(O),i(!1);case 9:case"end":return C.stop()}},c)})),M.apply(this,arguments)}function K(c,S){return V.apply(this,arguments)}function V(){return V=Z()(j()().mark(function c(S,x){var D,N;return j()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:N=new EventSource("/q/sendMsg/sse?".concat(Te().stringify(T()({ownerId:A,parentMessageId:((D=n(x))===null||D===void 0?void 0:D.parentMessageId)||""},S)))),N.addEventListener("open",function(){console.log("EventSource Connected!!")},!1),N.addEventListener("message",function(O){var R=JSON.parse(O.data),f=n(x);console.log("=== result:",O.data);var B=f==null?void 0:f.data.some(function(k){return k.type==="loading"});if(B){var G,$=(G=f==null?void 0:f.data.filter(function(k){return k.type!=="loading"}))!==null&&G!==void 0?G:[],ue={type:"answer",ownerId:A,ownerName:F,content:R.text,id:R.id};$.push(ue),u({data:$,parentMessageId:R.id,isInput:!0,isLoading:!1},x)}else{var C;if((f==null||(C=f.data[(f==null?void 0:f.data.length)-1])===null||C===void 0?void 0:C.type)==="answer"){var q=[].concat(E()(f==null?void 0:f.data.slice(0,-1)),[{type:"answer",ownerId:A,ownerName:F,content:R.text,id:R.id}]);u({data:q,parentMessageId:R.id,isInput:!0,isLoading:!1},x)}}R.done&&(u({isInput:!1},x),N.close())},!1),N.addEventListener("error",function(O){console.log("EventSource Error",O)},!1);case 4:case"end":return _.stop()}},c)})),V.apply(this,arguments)}function De(c){J(c.target.value||"")}function ie(c){return function(){if(h){var S=[{type:"question",ownerId:A,ownerName:F,content:h,id:Date.now()+""},{type:"loading",ownerId:A,ownerName:F,content:"",id:"loading_"+Date.now()}];r({append:S,isLoading:!0},c),K({msg:h},c)}c===(e==null?void 0:e.sessionId)&&J("")}}function Oe(c){c.code==="Enter"&&ie(e==null?void 0:e.sessionId)()}function re(){var c;i(!1),(c=v.current)===null||c===void 0||c.focus()}function oe(){var c,S;if(((c=s[s.length-1])===null||c===void 0?void 0:c.type)==="question"){var x={type:"loading",ownerId:A,ownerName:F,content:"",id:"loading_"+Date.now(),parentMessageId:""};r({append:[x],isLoading:!0},e==null?void 0:e.sessionId),K({msg:s[s.length-1].content},e==null?void 0:e.sessionId)}((S=s[s.length-1])===null||S===void 0?void 0:S.type)==="loading"&&(e==null?void 0:e.isLoading)===!1&&K({msg:s[s.length-1].content},e==null?void 0:e.sessionId)}return(0,p.useEffect)(function(){re(),oe()},[]),(0,p.useEffect)(function(){re(),oe()},[e==null?void 0:e.sessionId]),(0,p.useEffect)(function(){y(T()(T()({},e),{},{data:g.current.filter(function(c){return c.type!=="loading"})}))},[JSON.stringify(g.current)]),(0,a.jsxs)("div",{className:P.container,children:[(0,a.jsx)("div",{className:P.card,children:(0,a.jsx)(Se,{data:s,inputing:m})}),(0,a.jsxs)("div",{className:P.questionWrapper,children:[(0,a.jsx)("label",{className:P.labelForInput,children:(0,a.jsx)("input",{ref:v,className:P.input,value:h,onChange:De,onKeyUp:Oe,disabled:o,placeholder:"\u8BF7\u8F93\u5165\u60A8\u7684\u95EE\u9898"})}),(0,a.jsx)("button",{disabled:o||!h,type:"button",className:P.sendBtn,style:{cursor:o||!h?"not-allowed":"pointer"},onClick:ie(e==null?void 0:e.sessionId),children:"\u53D1\u9001"})]})]})}var Fe="chatgpt__data",ae="convasition_chatgpt__data",X=function(){return Math.random().toString(36).substring(2,10)},Ae={"layout-ai":"layout-ai___O2i1I",layoutAi:"layout-ai___O2i1I"},_e=function t(e,r){return e.find(function(u){return u.order===r})?t(e,r+1):r},W=(0,p.createContext)({result:[],active:null,setResult:function(){},setResultDataBySessionId:function(){},storageData:function(){},addResult:function(){},deleteResult:function(){},toggleActive:function(){},getConvasitionBySessionId:function(){},setResultBySessionId:function(){}});function Ee(t){var e=(0,p.useState)(n),r=Q()(e,2),u=r[0],y=r[1];function n(){var s;return(s=t.find(function(m){return m.active}))!==null&&s!==void 0?s:null}return(0,p.useEffect)(function(){y(n())},[JSON.stringify(t)]),u}function Le(){var t=(0,p.useState)([]),e=Q()(t,2),r=e[0],u=e[1],y=Ee(r),n=(0,se.Z)(r);(0,p.useEffect)(function(){s()},[]);function s(){var o=sessionStorage.getItem(ae);if(o){var i=JSON.parse(o);u(i)}else{var v={sessionId:X(),active:!0,title:"\u4F1A\u8BDD1",order:0,data:[],parentMessageId:"",isLoading:!1,isInput:!1};u([v])}}function m(o,i){console.log("-- setResultDataBySessionId result",n.current,o);var v=n.current.map(function(g){if(g.sessionId===i){var H=E()(g.data);return H.push.apply(H,E()(o.append)),T()(T()({},g),{data:H,isLoading:o.isLoading})}return g});u(v)}function l(o,i){console.log("-- setResultBySessionId result",n.current,o);var v=n.current.map(function(g){return g.sessionId===i?T()(T()({},g),o):g});u(v)}function I(o){var i=E()(n.current),v=i.findIndex(function(g){return g.sessionId===o.sessionId});v>-1&&(i[v]=o),i.length&&sessionStorage.setItem(ae,JSON.stringify(i))}function h(){var o=E()(n.current),i={sessionId:X(),active:!0,title:"\u4F1A\u8BDD".concat(o.length+1),order:_e(o,o.length),data:[],parentMessageId:"",isLoading:!1,isInput:!1};o.forEach(function(v){v.active=!1}),o.push(i),u(o)}function J(o){var i=E()(n.current),v=i.findIndex(function(M){return M.sessionId===o}),g=i.find(function(M){return M.sessionId===o});if(v>-1&&(i.splice(v,1),g!=null&&g.active&&i[i.length-1]&&(i[i.length-1].active=!0)),i.length)u(i);else{var H={sessionId:X(),active:!0,title:"\u4F1A\u8BDD1",order:0,data:[],parentMessageId:"",isLoading:!1,isInput:!1};u([H])}}function Y(o){var i=E()(n.current);i.forEach(function(v){v.active=v.sessionId===o}),u(i)}function b(o){return n.current.find(function(i){return i.sessionId===o})}return(0,a.jsx)(W.Provider,{value:{result:r,active:y,setResult:u,setResultDataBySessionId:m,storageData:I,addResult:h,deleteResult:J,toggleActive:Y,getConvasitionBySessionId:b,setResultBySessionId:l},children:(0,a.jsxs)("div",{className:Ae.layoutAi,children:[(0,a.jsx)(pe,{}),(0,a.jsx)(je,{})]})})}var Me=Le},4282:function(){}}]);
