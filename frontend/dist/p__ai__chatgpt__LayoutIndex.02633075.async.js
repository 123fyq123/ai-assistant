(self.webpackChunk=self.webpackChunk||[]).push([[332],{41093:function(_e,U,l){"use strict";l.r(U),l.d(U,{ChatContext:function(){return O},default:function(){return me}});var ee=l(57213),x=l.n(ee),te=l(93525),B=l.n(te),ne=l(54306),T=l.n(ne),y=l(93236),se=l(52510),ae=l.n(se),F=l(45924),C={"layout-ai-slider":"layout-ai-slider___B4QiI",layoutAiSlider:"layout-ai-slider___B4QiI",topDiv:"topDiv___yf52R","menus-ul":"menus-ul___X0HBg",menusUl:"menus-ul___X0HBg","menus-li":"menus-li___JqtHJ",menusLi:"menus-li___JqtHJ",active:"active___i5rvn","li-title":"li-title___ossXQ",liTitle:"li-title___ossXQ","li-btns":"li-btns___LxGsy",liBtns:"li-btns___LxGsy"},re=l(89260),t=l(62086);function ie(){var s=(0,y.useContext)(O),e=s.result,d=s.addResult,i=s.deleteResult,R=s.toggleActive;function n(o){return function(p){p.stopPropagation(),i(o.sessionId)}}function c(o){return function(p){p.stopPropagation();var S=e.find(function(A){return A.sessionId===o});S!=null&&S.active||R(o)}}function m(o){if(o.isLoading)return"\u67E5\u8BE2\u4E2D...";if(o.isInput)return"\u8F93\u5165\u4E2D...";var p;return((p=(0,re.Z)(o.data,function(S){return S.type==="question"}))===null||p===void 0?void 0:p.content)||o.title}return(0,t.jsxs)("div",{className:C.layoutAiSlider,children:[(0,t.jsx)("div",{className:C.topDiv,children:(0,t.jsx)("button",{type:"button",onClick:d,children:"+ \u6DFB\u52A0\u65B0\u4F1A\u8BDD"})}),(0,t.jsx)("ul",{className:C.menusUl,children:e.map(function(o){return(0,t.jsxs)("li",{className:(0,F.Z)(C.menusLi,ae()({},C.active,o.active)),onClick:c(o.sessionId),children:[(0,t.jsx)("div",{className:C.liTitle,children:m(o)}),(0,t.jsx)("div",{className:C.liBtns,children:(0,t.jsx)("button",{type:"button",onClick:n(o),children:"\u5220\u9664"})})]},o.sessionId)})})]})}var oe=l(25359),V=l.n(oe),le=l(49811),ue=l.n(le),de={loading:"loading___MehV4"};function ce(s){var e,d=Object.assign({},(e=s.style)!==null&&e!==void 0?e:{});return(0,t.jsxs)("div",{className:de.loading,style:d,children:[(0,t.jsx)("div",{}),(0,t.jsx)("div",{}),(0,t.jsx)("div",{})]})}var h={modifyBrowserScrollStyle:"modifyBrowserScrollStyle___W_Bf4",container:"container___kbjvA",ul:"ul___FpLJs",answerItem:"answerItem___vywcc",answerItemContent:"answerItemContent___jrp1w",logo:"logo___ESpoO",content:"content___vhxQQ",questionType:"questionType___Aagvk",triangle:"triangle___zwFRY",answerType:"answerType___A33LI",loadingType:"loadingType___C3NpY","answer-error":"answer-error___uJNJO",answerError:"answer-error___uJNJO"};function ve(s){var e=(0,y.useRef)(null),d={question:h.questionType,answer:h.answerType,loading:h.loadingType};(0,y.useEffect)(function(){e.current&&(e.current.scrollTop=e.current.scrollHeight)});function i(n,c){if(n.type==="answer"){var m=n.content.split(/(\n|\r|\r\n)/);return m.map(function(o,p){return(0,t.jsx)("p",{className:(0,F.Z)(n.error?h.answerError:"",s.inputing&&p===m.length-1&&c===s.data.length-1?"cursor-blingking":""),children:/^\s$/.test(o)?"":o.replace(/\s/g," ")},p)})}else{if(n.type==="question")return n.content;if(n.type==="loading")return(0,t.jsx)(ce,{style:{top:"6px"}})}}function R(n,c){if(n.type==="answer"||n.type==="question")return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:h.triangle}),i(n,c)]});if(n.type==="loading")return i(n,c)}return(0,t.jsx)("div",{className:h.container,ref:e,children:(0,t.jsx)("ul",{className:h.ul,children:s.data.map(function(n,c){return(0,t.jsx)("li",{className:h.answerItem,children:(0,t.jsxs)("div",{className:(0,F.Z)(h.answerItemContent,d[n.type]),children:[(0,t.jsx)("span",{className:h.logo,children:n.type==="question"&&(0,t.jsx)("span",{children:"\u6211"})}),(0,t.jsx)("div",{className:h.content,children:R(n,c)})]})},n.id)})})})}var w={container:"container___mJT0f",card:"card___ia0yb",questionWrapper:"questionWrapper___fmJv4",labelForInput:"labelForInput___qfwPY",input:"input___wbEmZ",sendBtn:"sendBtn___HlPFa"},X=l(17941),fe=l(38625),ge=l.n(fe),D="chenwy",P="xiaochen";function ye(){var s=(0,y.useContext)(O),e=s.active,d=s.setResultDataBySessionId,i=s.setResultBySessionId,R=s.storageData,n=s.getConvasitionBySessionId,c=(e==null?void 0:e.data)||[],m=(e==null?void 0:e.isInput)||!1,o=(0,y.useState)(""),p=T()(o,2),S=p[0],A=p[1],H=(0,y.useState)(!1),J=T()(H,2),a=J[0],r=J[1],v=(0,y.useRef)(null),f=(0,X.Z)(c);function N(u,E){return _.apply(this,arguments)}function _(){return _=ue()(V()().mark(function u(E,L){var Z,j;return V()().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:j=new EventSource("/q/sendMsg/sse?".concat(ge().stringify(x()({ownerId:D,parentMessageId:((Z=n(L))===null||Z===void 0?void 0:Z.parentMessageId)||""},E)))),j.addEventListener("open",function(){console.log("EventSource Connected!!")},!1),j.addEventListener("message",function(M){var g=JSON.parse(M.data),I=n(L);console.log("=== result:",M.data);var Ne=I==null?void 0:I.data.some(function(K){return K.type==="loading"});if(Ne){var W,k=(W=I==null?void 0:I.data.filter(function(K){return K.type!=="loading"}))!==null&&W!==void 0?W:[],Be={type:"answer",ownerId:D,ownerName:P,content:g.text,id:g.id,error:g.error};if(k.push(Be),i({data:k,parentMessageId:g.error?"":g.id,isInput:!g.error,isLoading:!1},L),g.error&&g.done){j.close();return}}else{var Y;if((I==null||(Y=I.data[(I==null?void 0:I.data.length)-1])===null||Y===void 0?void 0:Y.type)==="answer"){var Ce=[].concat(B()(I==null?void 0:I.data.slice(0,-1)),[{type:"answer",ownerId:D,ownerName:P,content:g.text,id:g.id,error:g.error}]);i({data:Ce,parentMessageId:g.error?"":g.id,isInput:!g.error,isLoading:!1},L),g.error&&j.close()}}g.done&&(i({isInput:!1,isLoading:!1},L),j.close())},!1),j.addEventListener("error",function(M){console.log("EventSource Error",M)},!1);case 4:case"end":return Q.stop()}},u)})),_.apply(this,arguments)}function xe(u){A(u.target.value||"")}function z(u){return function(){if(S){var E=[{type:"question",ownerId:D,ownerName:P,content:S,id:Date.now()+""},{type:"loading",content:"",id:"loading_"+Date.now()}];d({append:E,isLoading:!0},u),N({msg:S},u)}u===(e==null?void 0:e.sessionId)&&A("")}}function Re(u){u.code==="Enter"&&z(e==null?void 0:e.sessionId)()}function $(){var u;r(!1),(u=v.current)===null||u===void 0||u.focus()}function q(){var u=c[c.length-1];if((u==null?void 0:u.type)==="question"){var E={type:"loading",id:"loading_"+Date.now(),content:""};d({append:[E],isLoading:!0},e==null?void 0:e.sessionId),N({msg:u.content},e==null?void 0:e.sessionId)}}return(0,y.useEffect)(function(){$(),q()},[]),(0,y.useEffect)(function(){$(),q()},[e==null?void 0:e.sessionId]),(0,y.useEffect)(function(){R(x()(x()({},e),{},{data:f.current.filter(function(u){return u.type!=="loading"})}))},[JSON.stringify(f.current)]),(0,t.jsxs)("div",{className:w.container,children:[(0,t.jsx)("div",{className:w.card,children:(0,t.jsx)(ve,{data:c,inputing:m})}),(0,t.jsxs)("div",{className:w.questionWrapper,children:[(0,t.jsx)("label",{className:w.labelForInput,children:(0,t.jsx)("input",{ref:v,className:w.input,value:S,onChange:xe,onKeyUp:Re,disabled:a,placeholder:"\u8BF7\u8F93\u5165\u60A8\u7684\u95EE\u9898"})}),(0,t.jsx)("button",{disabled:a||!S,type:"button",className:w.sendBtn,style:{cursor:a||!S?"not-allowed":"pointer"},onClick:z(e==null?void 0:e.sessionId),children:"\u53D1\u9001"})]})]})}var je="chatgpt__data",b="convasition_chatgpt__data",G=function(){return Math.random().toString(36).substring(2,10)},pe={"layout-ai":"layout-ai___O2i1I",layoutAi:"layout-ai___O2i1I"},Ie=function s(e,d){return e.find(function(i){return i.order===d})?s(e,d+1):d},O=(0,y.createContext)({result:[],active:null,setResult:function(){},setResultDataBySessionId:function(){},storageData:function(){},addResult:function(){},deleteResult:function(){},toggleActive:function(){},getConvasitionBySessionId:function(){},setResultBySessionId:function(){}});function Se(s){var e=(0,y.useState)(n),d=T()(e,2),i=d[0],R=d[1];function n(){var c;return(c=s.find(function(m){return m.active}))!==null&&c!==void 0?c:null}return(0,y.useEffect)(function(){R(n())},[JSON.stringify(s)]),i}function he(){var s=(0,y.useState)([]),e=T()(s,2),d=e[0],i=e[1],R=Se(d),n=(0,X.Z)(d);(0,y.useEffect)(function(){c()},[]);function c(){var a=sessionStorage.getItem(b);if(a){var r=JSON.parse(a);i(r)}else{var v={sessionId:G(),active:!0,title:"\u4F1A\u8BDD1",order:0,data:[],parentMessageId:"",isLoading:!1,isInput:!1};i([v])}}function m(a,r){console.log("-- setResultDataBySessionId result",n.current,a);var v=n.current.map(function(f){if(f.sessionId===r){var N=B()(f.data);return N.push.apply(N,B()(a.append)),x()(x()({},f),{data:N,isLoading:a.isLoading})}return x()({},f)});i(v)}function o(a,r){console.log("-- setResultBySessionId result",n.current,a,r);var v=n.current.map(function(f){return f.sessionId===r?x()(x()({},f),a):x()({},f)});i(v)}function p(a){var r=B()(n.current),v=r.findIndex(function(f){return f.sessionId===a.sessionId});v>-1&&(r[v]=a),r.length&&sessionStorage.setItem(b,JSON.stringify(r))}function S(){var a=B()(n.current),r={sessionId:G(),active:!0,title:"\u4F1A\u8BDD".concat(a.length+1),order:Ie(a,a.length),data:[],parentMessageId:"",isLoading:!1,isInput:!1};a.forEach(function(v){v.active=!1}),a.push(r),i(a)}function A(a){var r=B()(n.current),v=r.findIndex(function(_){return _.sessionId===a}),f=r.find(function(_){return _.sessionId===a});if(v>-1&&(r.splice(v,1),f!=null&&f.active&&r[r.length-1]&&(r[r.length-1].active=!0)),r.length)i(r);else{var N={sessionId:G(),active:!0,title:"\u4F1A\u8BDD1",order:0,data:[],parentMessageId:"",isLoading:!1,isInput:!1};i([N])}}function H(a){var r=B()(n.current);r.forEach(function(v){v.active=v.sessionId===a}),i(r)}function J(a){return n.current.find(function(r){return r.sessionId===a})}return(0,t.jsx)(O.Provider,{value:{result:d,active:R,setResult:i,setResultDataBySessionId:m,storageData:p,addResult:S,deleteResult:A,toggleActive:H,getConvasitionBySessionId:J,setResultBySessionId:o},children:(0,t.jsxs)("div",{className:pe.layoutAi,children:[(0,t.jsx)(ie,{}),(0,t.jsx)(ye,{})]})})}var me=he},4282:function(){}}]);
