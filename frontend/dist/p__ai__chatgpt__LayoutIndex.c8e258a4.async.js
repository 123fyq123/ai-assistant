(self.webpackChunk=self.webpackChunk||[]).push([[332],{37674:function(et,ne,l){"use strict";l.r(ne),l.d(ne,{ChatContext:function(){return Y},default:function(){return $e}});var me=l(57213),O=l.n(me),ye=l(93525),_=l.n(ye),he=l(54306),F=l.n(he),tt="chatgpt__data",se="convasition_chatgpt__data",H=function(){return Math.random().toString(36).substring(2,10)},ae=l(17941),c=l(93236),xe=l(25359),w=l.n(xe),Ie=l(49811),z=l.n(Ie),Se={loading:"loading___MehV4"},e=l(62086);function je(t){var n,o=Object.assign({},(n=t.style)!==null&&n!==void 0?n:{});return(0,e.jsxs)("div",{className:Se.loading,style:o,children:[(0,e.jsx)("div",{}),(0,e.jsx)("div",{}),(0,e.jsx)("div",{})]})}var Q=l(45924),B={modifyBrowserScrollStyle:"modifyBrowserScrollStyle___W_Bf4",container:"container___kbjvA",ul:"ul___FpLJs",answerItem:"answerItem___vywcc",answerItemContent:"answerItemContent___jrp1w",logo:"logo___ESpoO",content:"content___vhxQQ",questionType:"questionType___Aagvk",triangle:"triangle___zwFRY",answerType:"answerType___A33LI",loadingType:"loadingType___C3NpY","answer-error":"answer-error___uJNJO",answerError:"answer-error___uJNJO"};function Ne(t){var n=(0,c.useRef)(null),o={question:B.questionType,answer:B.answerType,loading:B.loadingType};(0,c.useEffect)(function(){n.current&&(n.current.scrollTop=n.current.scrollHeight)});function u(s,r){if(s.type==="answer"){var S=s.content.split(/(\n|\r|\r\n)/);return S.map(function(m,R){return(0,e.jsx)("p",{className:(0,Q.Z)(s.error?B.answerError:"",t.inputing&&R===S.length-1&&r===t.data.length-1?"cursor-blingking":""),children:/^\s$/.test(m)?"":m.replace(/\s/g," ")},R)})}else{if(s.type==="question")return s.content;if(s.type==="loading")return(0,e.jsx)(je,{style:{top:"6px"}})}}function p(s,r){if(s.type==="answer"||s.type==="question")return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:B.triangle}),u(s,r)]});if(s.type==="loading")return u(s,r)}return(0,e.jsx)("div",{className:B.container,ref:n,children:(0,e.jsx)("ul",{className:B.ul,children:t.data.map(function(s,r){return(0,e.jsx)("li",{className:B.answerItem,children:(0,e.jsxs)("div",{className:(0,Q.Z)(B.answerItemContent,o[s.type]),children:[(0,e.jsx)("span",{className:B.logo,children:s.type==="question"&&(0,e.jsx)("span",{children:"\u6211"})}),(0,e.jsx)("div",{className:B.content,children:p(s,r)})]})},s.id)})})})}function ie(){var t=localStorage.getItem("settings");return t?JSON.parse(t):null}function Re(t){localStorage.setItem("settings",JSON.stringify(t))}var Ce=l(38625),Ee=l.n(Ce),Z={container:"container___mJT0f",card:"card___ia0yb",questionWrapper:"questionWrapper___fmJv4",labelForInput:"labelForInput___qfwPY",input:"input___wbEmZ",sendBtn:"sendBtn___HlPFa"},U="chenwy",W="xiaochen";function Be(){var t=(0,c.useContext)(Y),n=t.active,o=t.setResultDataBySessionId,u=t.setResultBySessionId,p=t.storageData,s=t.getConvasitionBySessionId,r=(n==null?void 0:n.data)||[],S=(n==null?void 0:n.isInput)||!1,m=(0,c.useState)(""),R=F()(m,2),v=R[0],y=R[1],D=(0,c.useState)(!1),C=F()(D,2),A=C[0],i=C[1],d=(0,c.useRef)(null),f=(0,ae.Z)(r);function a(g,M){return x.apply(this,arguments)}function x(){return x=z()(w()().mark(function g(M,b){var X,E,L;return w()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:E=ie(),L=new EventSource("/q/sendMsg/sse?".concat(Ee().stringify(O()({apiKey:E==null?void 0:E.apiKey,temperature:E==null?void 0:E.temperature,top_p:E==null?void 0:E.top_p,model:E==null?void 0:E.model,ownerId:U,parentMessageId:((X=s(b))===null||X===void 0?void 0:X.parentMessageId)||""},M)))),L.addEventListener("open",function(){console.log("EventSource Connected!!")},!1),L.addEventListener("message",function(K){var j=JSON.parse(K.data),N=s(b);console.log("=== result:",K.data);var Xe=N==null?void 0:N.data.some(function(te){return te.type==="loading"});if(Xe){var q,pe=(q=N==null?void 0:N.data.filter(function(te){return te.type!=="loading"}))!==null&&q!==void 0?q:[],ke={type:"answer",ownerId:U,ownerName:W,content:j.text,id:j.id,error:j.error};if(pe.push(ke),u({data:pe,parentMessageId:j.error?"":j.id,isInput:!j.error,isLoading:!1},b),j.error&&j.done){L.close();return}}else{var ee;if((N==null||(ee=N.data[(N==null?void 0:N.data.length)-1])===null||ee===void 0?void 0:ee.type)==="answer"){var qe=[].concat(_()(N==null?void 0:N.data.slice(0,-1)),[{type:"answer",ownerId:U,ownerName:W,content:j.text,id:j.id,error:j.error}]);u({data:qe,parentMessageId:j.error?"":j.id,isInput:!j.error,isLoading:!1},b),j.error&&L.close()}}j.done&&(u({isInput:!1,isLoading:!1},b),L.close())},!1),L.addEventListener("error",function(K){console.log("EventSource Error",K)},!1);case 5:case"end":return k.stop()}},g)})),x.apply(this,arguments)}function I(g){y(g.target.value||"")}function G(g){return function(){if(v){var M=[{type:"question",ownerId:U,ownerName:W,content:v,id:Date.now()+""},{type:"loading",content:"",id:"loading_"+Date.now()}];o({append:M,isLoading:!0},g),a({msg:v},g)}g===(n==null?void 0:n.sessionId)&&y("")}}function Ve(g){g.code==="Enter"&&G(n==null?void 0:n.sessionId)()}function fe(){var g;i(!1),(g=d.current)===null||g===void 0||g.focus()}function ge(){var g=r[r.length-1];if((g==null?void 0:g.type)==="question"){var M={type:"loading",id:"loading_"+Date.now(),content:""};o({append:[M],isLoading:!0},n==null?void 0:n.sessionId),a({msg:g.content},n==null?void 0:n.sessionId)}}return(0,c.useEffect)(function(){fe(),ge()},[]),(0,c.useEffect)(function(){fe(),ge()},[n==null?void 0:n.sessionId]),(0,c.useEffect)(function(){p(O()(O()({},n),{},{data:f.current.filter(function(g){return g.type!=="loading"})}))},[JSON.stringify(f.current)]),(0,e.jsxs)("div",{className:Z.container,children:[(0,e.jsx)("div",{className:Z.card,children:(0,e.jsx)(Ne,{data:r,inputing:S})}),(0,e.jsxs)("div",{className:Z.questionWrapper,children:[(0,e.jsx)("label",{className:Z.labelForInput,children:(0,e.jsx)("input",{ref:d,className:Z.input,value:v,onChange:I,onKeyUp:Ve,disabled:A,placeholder:"\u8BF7\u8F93\u5165\u60A8\u7684\u95EE\u9898"})}),(0,e.jsx)("button",{disabled:A||!v,type:"button",className:Z.sendBtn,style:{cursor:A||!v?"not-allowed":"pointer"},onClick:G(n==null?void 0:n.sessionId),children:"\u53D1\u9001"})]})]})}var De=l(52510),Ae=l.n(De),Oe=l(79910),Fe=l(53839),re=l(65132),Te=l(55362),_e=l(64755),Le=l(99168);function le(t,n,o,u){return $.apply(this,arguments)}function $(){return $=z()(w()().mark(function t(n,o,u,p){var s,r;return w()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,(0,_e.request)(n,Object.assign({method:o,getResponse:!0,headers:{"X-Trace-Id":(0,Le.Z)()}},o==="GET"?{params:u}:{data:u},p));case 2:return r=m.sent,m.abrupt("return",(s=r==null?void 0:r.data)!==null&&s!==void 0?s:{});case 4:case"end":return m.stop()}},t)})),$.apply(this,arguments)}function we(t,n,o){return le(t,"GET",n,o)}function nt(t,n,o){return le(t,"POST",n,o)}var Ze={getUserInfo:function(){var t=z()(w()().mark(function o(u){var p;return w()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,we("/q/getUserInfo",u);case 2:return p=r.sent,console.log("getUserInfo - /q/getUserInfo:",p),r.abrupt("return",p);case 5:case"end":return r.stop()}},o)}));function n(o){return t.apply(this,arguments)}return n}()},Me=l(33548),oe=l(16741),Je=l(87482),ue=l.n(Je),h={container:"container___Hv3tX",info:"info___ufyKZ",item:"item___FK_20",title:"title___W73J7","error-msg":"error-msg___U9mzO",errorMsg:"error-msg___U9mzO",content:"content___qI5DQ"};function be(t){var n=function(){t.setOpen(!1)},o=function(){t.setOpen(!1)},u=(0,c.useState)(void 0),p=F()(u,2),s=p[0],r=p[1],S=(0,c.useState)(!1),m=F()(S,2),R=m[0],v=m[1],y=(0,c.useState)(""),D=F()(y,2),C=D[0],A=D[1];return(0,c.useEffect)(function(){t.open&&(v(!0),Ze.getUserInfo().then(function(i){i.code===200?(r(i.data),A("")):(r(void 0),A(i.msg)),v(!1)}).catch(function(){r(void 0),v(!1)}))},[t.open]),(0,e.jsx)(oe.Z,{title:"\u8D26\u6237\u4FE1\u606F",open:t.open,onOk:n,onCancel:o,okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88",children:(0,e.jsx)("div",{className:h.container,children:R?(0,e.jsx)("div",{className:h.loading,children:(0,e.jsx)(Me.Z,{spin:!0})}):C?(0,e.jsxs)("div",{className:h.errorMsg,children:[(0,e.jsx)("div",{className:h.title,children:"Error:"}),(0,e.jsx)("div",{className:h.content,children:C})]}):s?(0,e.jsxs)("div",{className:h.info,children:[(0,e.jsxs)("div",{className:h.item,children:[(0,e.jsx)("span",{className:h.title,children:"\u8D26\u6237\u603B\u91CF:"}),(0,e.jsxs)("span",{children:["$",s.total]})]}),(0,e.jsxs)("div",{className:h.item,children:[(0,e.jsx)("span",{className:h.title,children:"\u4F7F\u7528\u91CF:"}),(0,e.jsxs)("span",{children:["$",s.used]})]}),(0,e.jsxs)("div",{className:h.item,children:[(0,e.jsx)("span",{className:h.title,children:"\u5269\u4F59\u91CF:"}),(0,e.jsxs)("span",{children:["$",s.available]})]}),(0,e.jsxs)("div",{className:h.item,children:[(0,e.jsx)("span",{className:h.title,children:"\u5957\u9910\u4FE1\u606F:"}),(0,e.jsx)("div",{className:h.packages,children:s.grants.data.map(function(i){return(0,e.jsxs)("div",{className:h.package,children:[(0,e.jsx)("span",{children:"\u6709\u6548\u671F\uFF1A"}),(0,e.jsxs)("span",{children:[ue()(i.effective_at*1e3).format("YYYY-MM-DD")," "]}),(0,e.jsx)("span",{children:"-"}),(0,e.jsx)("span",{children:ue()(i.expires_at*1e3).format("YYYY-MM-DD")})]},i.id)})})]})]}):(0,e.jsx)("div",{className:h.noData})})})}var Ue={title:"title___ngNNT"};function de(t){return(0,e.jsx)("div",{className:Ue.title,children:t.title.split(t.split).map(function(n,o){return(0,e.jsx)("p",{children:n},o)})})}var ce=l(1959),J=l(50568),Pe=l(60941),V=l(28332),ve=l(49112),Ye=l(434),P={container:"container___U2z83",form:"form___Eow1s",tooltip:"tooltip___g3lx1"};function Ge(t){var n=function(){var y;(y=u.current)===null||y===void 0||y.submit(),t.setOpen(!1)},o=function(){t.setOpen(!1)},u=(0,c.useRef)(null),p={apiKey:"",model:"gpt-3.5-turbo",temperature:.8,top_p:1},s=[{required:!1,message:"\u4E0D\u586B\u503C\u65F6\u4F7F\u7528\u7CFB\u7EDF\u9ED8\u8BA4key"}],r=[{required:!1}],S=[{required:!1}];(0,c.useEffect)(function(){if(t.open){var v=ie();v&&(0,Ye.Z)(v,function(y,D){var C;(C=u.current)===null||C===void 0||C.setFieldValue(D,y)})}},[t.open]);var m=function(y){console.log("submit",y),Re(y)},R=function(y){console.log("submitError",y)};return(0,e.jsx)(oe.Z,{title:"ChatGPT \u914D\u7F6E",open:t.open,onOk:n,onCancel:o,okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88",width:600,destroyOnClose:!1,children:(0,e.jsx)("div",{className:P.container,children:(0,e.jsxs)(J.Z,{className:P.form,name:"setting",layout:"horizontal",ref:u,labelCol:{span:6},wrapperCol:{span:16,offset:2},initialValues:p,onFinish:m,onFinishFailed:R,children:[(0,e.jsx)(J.Z.Item,{label:"apiKey",name:"apiKey",rules:s,children:(0,e.jsx)(Pe.Z,{placeholder:"\u4E0D\u586B\u503C\u65F6\u4F7F\u7528\u7CFB\u7EDF\u9ED8\u8BA4key"})}),(0,e.jsx)(J.Z.Item,{label:"model",name:"model",children:(0,e.jsxs)(V.Z,{children:[(0,e.jsx)(V.Z.Option,{value:"gpt-3.5-turbo",children:"gpt-3.5-turbo"}),(0,e.jsx)(V.Z.Option,{value:"gpt-4",children:"gpt-4"})]})}),(0,e.jsx)(J.Z.Item,{label:"temperature",name:"temperature",tooltip:{title:(0,e.jsx)(de,{title:"\u53EF\u9009\uFF0C\u9ED8\u8BA4\u662F1\u3002<br/>\u4F7F\u7528\u54EA\u4E2A\u91C7\u6837\u6E29\u5EA6\uFF0C\u57280\u548C2\u4E4B\u95F4\u3002\u8F83\u9AD8\u7684\u503C\uFF0C\u59820.8\u4F1A\u4F7F\u8F93\u51FA\u66F4\u968F\u673A\uFF0C\u800C\u8F83\u4F4E\u7684\u503C\uFF0C\u59820.2\u4F1A\u4F7F\u5176\u66F4\u52A0\u96C6\u4E2D\u548C\u786E\u5B9A\u6027\u3002<br/>\u6211\u4EEC\u901A\u5E38\u5EFA\u8BAE\u66F4\u6539\u6B64\u53C2\u6570\u6216 top_p \u53C2\u6570\uFF0C\u4F46\u4E0D\u8981\u540C\u65F6\u66F4\u6539\u4E24\u8005\u3002",split:"<br/>"}),overlayClassName:P.tooltip,icon:(0,e.jsx)(ce.Z,{})},rules:r,children:(0,e.jsx)(ve.Z,{min:0,max:2,step:.1})}),(0,e.jsx)(J.Z.Item,{label:"top_p",name:"top_p",rules:S,tooltip:{title:(0,e.jsx)(de,{title:"\u53EF\u9009\uFF0C\u9ED8\u8BA4\u662F1\u3002<br/>\u4E00\u79CD\u66FF\u4EE3temperature\u91C7\u6837\u7684\u65B9\u6CD5\u53EB\u505A\u6838\u5FC3\u91C7\u6837\uFF0C\u6A21\u578B\u8003\u8651\u5177\u6709 top_p \u6982\u7387\u8D28\u91CF\u7684\u6807\u8BB0\u7ED3\u679C\u3002\u56E0\u6B64\uFF0C0.1 \u8868\u793A\u4EC5\u8003\u8651\u7EC4\u6210\u524D 10% \u6982\u7387\u8D28\u91CF\u7684\u6807\u8BB0\u3002<br/>\u6211\u4EEC\u901A\u5E38\u5EFA\u8BAE\u66F4\u6539\u6B64\u53C2\u6570\u6216 temperature \u53C2\u6570\uFF0C\u4F46\u4E0D\u8981\u540C\u65F6\u66F4\u6539\u4E24\u8005\u3002",split:"<br/>"}),overlayClassName:P.tooltip,icon:(0,e.jsx)(ce.Z,{})},children:(0,e.jsx)(ve.Z,{min:0,max:1,step:.1})})]})})})}var T={"layout-ai-slider":"layout-ai-slider___B4QiI",layoutAiSlider:"layout-ai-slider___B4QiI",topDiv:"topDiv___yf52R",content:"content___FxF_c","menus-ul":"menus-ul___X0HBg",menusUl:"menus-ul___X0HBg","menus-li":"menus-li___JqtHJ",menusLi:"menus-li___JqtHJ",active:"active___i5rvn","li-title":"li-title___ossXQ",liTitle:"li-title___ossXQ","li-btns":"li-btns___LxGsy",liBtns:"li-btns___LxGsy",bottomDiv:"bottomDiv___DTjke"};function Ke(){var t=(0,c.useContext)(Y),n=t.result,o=t.addResult,u=t.deleteResult,p=t.toggleActive,s=t.getActiveResult,r=(0,c.useState)(!1),S=F()(r,2),m=S[0],R=S[1],v=(0,c.useState)(!1),y=F()(v,2),D=y[0],C=y[1];function A(a){return function(x){x.stopPropagation(),u(a.sessionId)}}function i(){var a=s();if(a!=null&&a.isLoading||a!=null&&a.isInput){window.alert("\u6570\u636E\u6B63\u5728\u8BF7\u6C42\u6216\u8F93\u5165\u4E2D\uFF0C\u8BF7\u7A0D\u540E\u518D\u6DFB\u52A0\u65B0\u56DE\u8BDD");return}o()}function d(a){return function(x){x.stopPropagation();var I=n.find(function(G){return G.sessionId===a});if(!(I!=null&&I.active)){if(I!=null&&I.isLoading||I!=null&&I.isInput){window.alert("\u6B63\u5728\u52A0\u8F7D\u4E2D\u6216\u8005\u6B63\u5728\u8F93\u5165\u4E2D\uFF0C\u4E0D\u80FD\u5207\u6362");return}p(a)}}}function f(a){if(a.isLoading)return"\u67E5\u8BE2\u4E2D...";if(a.isInput)return"\u8F93\u5165\u4E2D...";var x;return((x=(0,Te.Z)(a.data,function(I){return I.type==="question"}))===null||x===void 0?void 0:x.content)||a.title}return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:T.layoutAiSlider,children:[(0,e.jsx)("div",{className:T.topDiv,children:(0,e.jsx)("button",{type:"button",onClick:i,children:"+ \u6DFB\u52A0\u65B0\u4F1A\u8BDD"})}),(0,e.jsx)("div",{className:T.content,children:(0,e.jsx)("ul",{className:T.menusUl,children:n.map(function(a){return(0,e.jsxs)("li",{className:(0,Q.Z)(T.menusLi,Ae()({},T.active,a.active)),onClick:d(a.sessionId),children:[(0,e.jsx)("div",{className:T.liTitle,children:f(a)}),(0,e.jsx)("div",{className:T.liBtns,children:(0,e.jsx)("button",{type:"button",onClick:A(a),children:"\u5220\u9664"})})]},a.sessionId)})})}),(0,e.jsxs)("div",{className:T.bottomDiv,children:[(0,e.jsx)(re.ZP,{type:"default",shape:"default",icon:(0,e.jsx)(Oe.Z,{}),size:"middle",style:{marginBottom:"8px"},onClick:function(){return C(!0)},children:"\u8BBE\u7F6E"}),(0,e.jsx)(re.ZP,{type:"default",shape:"default",icon:(0,e.jsx)(Fe.Z,{}),size:"middle",onClick:function(){return R(!0)},children:"\u8D26\u6237"})]})]}),(0,e.jsx)(be,{open:m,setOpen:R}),(0,e.jsx)(Ge,{open:D,setOpen:C})]})}var He={"layout-ai":"layout-ai___O2i1I",layoutAi:"layout-ai___O2i1I"},ze=function t(n,o){return n.find(function(u){return u.order===o})?t(n,o+1):o},Y=(0,c.createContext)({result:[],active:null,setResult:function(){},setResultDataBySessionId:function(){},storageData:function(){},addResult:function(){},deleteResult:function(){},toggleActive:function(){},getConvasitionBySessionId:function(){},setResultBySessionId:function(){},getActiveResult:function(){}});function Qe(t){var n=(0,c.useState)(s),o=F()(n,2),u=o[0],p=o[1];function s(){var r;return(r=t.find(function(S){return S.active}))!==null&&r!==void 0?r:null}return(0,c.useEffect)(function(){p(s())},[JSON.stringify(t)]),u}function We(){var t=(0,c.useState)([]),n=F()(t,2),o=n[0],u=n[1],p=Qe(o),s=(0,ae.Z)(o);(0,c.useEffect)(function(){r()},[]);function r(){var i=sessionStorage.getItem(se);if(i){var d=JSON.parse(i);d.forEach(function(a){a.isInput=!1}),u(d)}else{var f={sessionId:H(),active:!0,title:"\u4F1A\u8BDD1",order:0,data:[],parentMessageId:"",isLoading:!1,isInput:!1};u([f])}}function S(i,d){console.log("-- setResultDataBySessionId result",s.current,i);var f=s.current.map(function(a){if(a.sessionId===d){var x=_()(a.data);return x.push.apply(x,_()(i.append)),O()(O()({},a),{data:x,isLoading:i.isLoading})}return O()({},a)});u(f)}function m(i,d){console.log("-- setResultBySessionId result",s.current,i,d);var f=s.current.map(function(a){return a.sessionId===d?O()(O()({},a),i):O()({},a)});u(f)}function R(i){var d=_()(s.current),f=d.findIndex(function(a){return a.sessionId===i.sessionId});f>-1&&(d[f]=i),d.length&&sessionStorage.setItem(se,JSON.stringify(d))}function v(){var i=_()(s.current),d={sessionId:H(),active:!0,title:"\u4F1A\u8BDD".concat(i.length+1),order:ze(i,i.length),data:[],parentMessageId:"",isLoading:!1,isInput:!1};i.forEach(function(f){f.active=!1}),i.push(d),u(i)}function y(i){var d=_()(s.current),f=d.findIndex(function(I){return I.sessionId===i}),a=d.find(function(I){return I.sessionId===i});if(f>-1&&(d.splice(f,1),a!=null&&a.active&&d[d.length-1]&&(d[d.length-1].active=!0)),d.length)u(d);else{var x={sessionId:H(),active:!0,title:"\u4F1A\u8BDD1",order:0,data:[],parentMessageId:"",isLoading:!1,isInput:!1};u([x])}}function D(i){var d=_()(s.current);d.forEach(function(f){f.active=f.sessionId===i}),u(d)}function C(i){return s.current.find(function(d){return d.sessionId===i})}function A(){return s.current.find(function(i){return i.active})}return(0,e.jsx)(Y.Provider,{value:{result:o,active:p,setResult:u,setResultDataBySessionId:S,storageData:R,addResult:v,deleteResult:y,toggleActive:D,getConvasitionBySessionId:C,setResultBySessionId:m,getActiveResult:A},children:(0,e.jsxs)("div",{className:He.layoutAi,children:[(0,e.jsx)(Ke,{}),(0,e.jsx)(Be,{})]})})}var $e=We},4282:function(){}}]);
